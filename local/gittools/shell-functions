# -*- shell-script -*-
# These functions are useful functions when working with a bash shell
# within a Net-SNMP git checkout.

nsbuildroot=$HOME/ns-build-root
nsecho=""

_ns_maybemkdir () {
    dir=$1
    if [ ! -d $dir ] ; then
	mkdir -p $dir
    fi
}

_ns_switchtobuilddir () {
    dir=$1
    _ns_maybemkdir $dir
    cd $dir
}

_ns_getbuilddir() {
    snmpsuffix="$1"
    snmpbranch=`git branch | egrep '^\*' | sed 's/^..//'`
    SNMPBUILDDIR="$snmpbuildroot/$snmpbranch"
    SNMPSRCDIR="$PWD"

    # add on the suffix if created
    if [ "$suffix" != "" ]; then
	SNMPBUILDDIR="$snmpbranch-$snmpsuffix"
    fi
}

_ns_setbuilddir() {
    _ns_getbuilddir "$1"
    _ns_switchtobuilddir $SNMPBUILDDIR
}

_ns_cleanup() {
    cd $SNMPSRCDIR
}

#
# snmpmake [-s suffix]
#   runs 'make' in $snmpbuildroot/branch[-suffix]
nsmake () {
    if [ "$1" = "-s" ]; then
	shift
        _ns_setbuilddir "$1"
	shift
    else
        _ns_setbuilddir
    fi

    $nsecho make "$@"

    _ns_cleanup
}

#
# snmpconfigure [-s suffix] [configure arguments]
#   runs 'configure' in $snmpbuildroot/branch[-suffix] with passed arguments
nsconfigure () {
    if [ "$1" = "-s" ]; then
	shift
        _ns_setbuilddir "$1"
	shift
    else
        _ns_setbuilddir
    fi
    
    $nsecho $SNMPSRCDIR/configure "$@"
    
    _ns_cleanup
}
